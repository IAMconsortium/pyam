language: sh

matrix:
    include:
        - os: linux
          env: PYENV=py37
        - os: linux
          env: PYENV=py27
        - os: osx
          env: PYENV=py37
        - os: osx
          env: PYENV=py27
# Observed on 10-Feb-19, choclatey builds for miniconda3 break
# see: https://github.com/conda/conda/issues/6064
# It is not clear how/when this can be fixed, so turn this back off for now
#        - os: windows
#          env: PYENV=py37
# there is no maintained miniconda2 package for chocolatey
#        - os: windows
#          env: PYENV=py27

before_install:
  - source ./ci/env.sh
  - bash ./ci/travis-install.sh
  - source activate testing
  - make virtual-environment

install:
  - make install

script:
  - python -c "import os, sys; assert os.environ['PYVERSION'] == sys.version[0]"
  - make test
  # silly problems are there for building docs in windows and py2 (tries to look for py3 jupyter kernel)
  - cd doc
  - if [[ "${PYENV}" == "py37" && "${TRAVIS_OS_NAME}" != 'windows' ]]; then make html; fi
  - cd ..

after_success:
  - cd tests && coveralls
